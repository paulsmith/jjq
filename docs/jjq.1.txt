JJQ(1)                      General Commands Manual                     JJQ(1)

NNAAMMEE
       jjq - local merge queue for jj

SSYYNNOOPPSSIISS
       jjjjqq iinniitt [----ttrruunnkk _b_o_o_k_m_a_r_k] [----cchheecckk _c_o_m_m_a_n_d] [----ssttrraatteeggyy _s_t_r_a_t_e_g_y]
       jjjjqq ppuusshh _r_e_v_s_e_t
       jjjjqq rruunn [----aallll] [----ssttoopp--oonn--ffaaiilluurree]
       jjjjqq cchheecckk [----rreevv _r_e_v_s_e_t] [--vv]
       jjjjqq ssttaattuuss [_i_d] [----jjssoonn] [----rreessoollvvee _c_h_a_n_g_e___i_d]
       jjjjqq ddeelleettee _i_d
       jjjjqq cclleeaann
       jjjjqq ddooccttoorr
       jjjjqq ccoonnffiigg [_k_e_y [_v_a_l_u_e]]
       jjjjqq ttaaiill [----aallll] [----nnoo--ffoollllooww]
       jjjjqq qquuiicckkssttaarrtt

DDEESSCCRRIIPPTTIIOONN
       jjjjqq is a local merge queue for jjjj(1) (Jujutsu VCS).  It queues
       revisions for merging to a trunk bookmark, processes them in FIFO
       order, and gates each merge on a configurable check command.  This
       prevents the "works on my branch" problem where changes pass checks
       individually but fail when combined with concurrent work.

       jjjjqq stores all state inside the jj repository using bookmarks and an
       isolated metadata branch.  No external database or service is required.

CCOOMMMMAANNDDSS
   iinniitt [----ttrruunnkk _b_o_o_k_m_a_r_k] [----cchheecckk _c_o_m_m_a_n_d] [----ssttrraatteeggyy _s_t_r_a_t_e_g_y]
       Initialize jjq in the current repository.  Sets up the metadata branch
       and configures the trunk bookmark and check command.

       With ----ttrruunnkk and ----cchheecckk flags, runs non-interactively.  Without flags,
       prompts for each value.  The trunk bookmark defaults to mmaaiinn if that
       bookmark exists, or mmaasstteerr as a fallback.

       If stdin is not a terminal and required flags are missing, exits with
       an error.

       Refuses to run if jjq is already initialized.  Use jjjjqq ccoonnffiigg to change
       settings after initialization.

       After configuration, runs jjjjqq ddooccttoorr to validate the setup.

   ppuusshh _r_e_v_s_e_t
       Queue a revision for merging to trunk.  The revset must resolve to
       exactly one revision.

       Before queuing, jjjjqq creates a temporary merge commit between the trunk
       and the candidate to check for textual conflicts.  If conflicts are
       detected, the push is rejected with exit code 1.

       Push is idempotent for the same change ID: if the change is already
       queued or failed, the stale entry is cleared and the revision is
       re-queued.  If the exact same commit ID is already queued, the push is
       rejected as a duplicate (usage error).

              jjq push @              # queue the working copy
              jjq push feat-xyz@      # queue a workspace's working copy
              jjq push abc123         # queue by change ID

   rruunn [----aallll] [----ssttoopp--oonn--ffaaiilluurree]
       Process the next queued item.  Creates a temporary jj workspace to test
       the candidate against trunk, then runs the configured check command
       inside it.

       On success, the trunk bookmark advances and the temporary workspace is
       cleaned up.

       On failure (conflicts or check command failure), the item moves to the
       failed list.  The temporary workspace is preserved for debugging.

       If the trunk bookmark moves during processing (e.g., another runner
       advanced it), the run aborts and instructs the user to retry.

       With ----aallll, processes items in a loop until the queue is empty.
       Failures are recorded and processing continues unless ----ssttoopp--oonn--ffaaiilluurree
       is set. Reports the count of successes and failures.

       Returns 0 if all processed items succeeded (or the queue was empty).
       Returns 2 if any items failed. Returns 1 if the run lock is
       unavailable, a conflict is detected, or trunk moved during processing.

   cchheecckk [----rreevv _r_e_v_s_e_t] [--vv]
       Run the configured check command against a revision in a temporary
       workspace without any queue processing.  Useful for verifying that the
       check command works before queuing items.

       Defaults to the current working copy (@@) if ----rreevv is not specified.

       With --vv (----vveerrbboossee), prints the workspace path, shell, and all
       environment variables before running the check command.  Useful for
       diagnosing path or environment issues.

       The temporary workspace is always cleaned up, regardless of outcome.
       Exits 0 if the check passes; 1 if it fails.

   ssttaattuuss [_i_d] [----jjssoonn] [----rreessoollvvee _c_h_a_n_g_e___i_d]
       Display the current queue state: queued items (ascending by sequence
       ID) and recent failures (descending by sequence ID).  Each entry shows
       its sequence ID, change ID prefix, and first line of the commit
       description.

       Also indicates if a run lock is currently held (another jjjjqq rruunn is in
       progress).

       With ----jjssoonn, outputs structured JSON with rruunnnniinngg, qquueeuuee, and ffaaiilleedd
       fields.  Queue items include cchhaannggee__iidd, ccoommmmiitt__iidd, and ddeessccrriippttiioonn.
       Failed items include ccaannddiiddaattee__cchhaannggee__iidd, ccaannddiiddaattee__ccoommmmiitt__iidd,
       ddeessccrriippttiioonn (original candidate message), ttrruunnkk__ccoommmmiitt__iidd,
       wwoorrkkssppaaccee__ppaatthh, and ffaaiilluurree__rreeaassoonn.

       With a positional _i_d, displays a single item's detail view (from either
       queue or failed).  With ----rreessoollvvee, looks up an item by its candidate
       change ID.  _i_d and ----rreessoollvvee are mutually exclusive.

   ddeelleettee _i_d
       Remove an item from the queue or the failed list by its sequence ID.
       The sequence ID is the number shown in ssttaattuuss output and ppuusshh
       confirmation messages.

   cclleeaann
       Remove jjq workspaces left behind by failed merges. Removes all
       directories named like jjjjqq--rruunn--XXXXXXXXXXXX.  Safe to run at any time -- only
       removes jjq-owned workspaces, never user workspaces.

   ttaaiill [----aallll] [----nnoo--ffoollllooww]
       View the check command output stored in _._j_j_/_j_j_q_-_r_u_n_._l_o_g.  By default
       shows the last 20 lines and follows until a sentinel line is seen.
       With ----aallll shows from the beginning. With ----nnoo--ffoollllooww dumps once and
       exits.

   qquuiicckkssttaarrtt
       Print a brief quickstart guide for LLM agents.

   ddooccttoorr
       Validate that the jjq environment is correctly configured.  Checks the
       trunk bookmark, check command, lock state, and workspace preconditions.
       Each check is reported as ookk, WWAARRNN, or FFAAIILL.  When a check fails, a
       suggested fix is shown.

       Exits 0 if no failures are found (warnings are tolerated).  Exits 1 if
       any check fails.

   ccoonnffiigg [_k_e_y [_v_a_l_u_e]]
       Get or set configuration.  With no arguments, displays all
       configuration values.  With one argument, displays that key's value.
       With two arguments, sets the key to the given value.

       Valid keys:

       ttrruunnkk__bbooookkmmaarrkk (default: "main")
              The bookmark that jjjjqq treats as the protected trunk.  All merges
              target this bookmark.

       cchheecckk__ccoommmmaanndd (required)
              Shell command to run in the merge workspace to validate a
              candidate.  Should run tests, lints, type checks, or whatever
              gates your trunk.  Exit 0 means pass; non-zero means fail.

              Set during jjjjqq iinniitt or configured afterward with jjjjqq ccoonnffiigg.

       ssttrraatteeggyy (default: "rebase" for new repos)
              How candidates are landed on trunk.  rreebbaassee duplicates the
              candidate onto trunk for linear history, preserving the original
              change ID.  mmeerrggee creates a merge commit with two parents.
              Existing repositories initialized before strategy support
              default to mmeerrggee.

EEXXIITT CCOODDEESS
       00      Success.

       11      Conflict during push or run, check failure in single-run mode,
              trunk moved, or run lock unavailable.

       22      Partial batch run: at least one item failed while processing jjjjqq
              rruunn ----aallll.

       33      Sequence ID allocation lock held (another push in progress).

       1100     Usage error. Bad arguments, ambiguous revset, duplicate push of
              the exact same commit ID, etc.

CCOONNFFIIGGUURRAATTIIOONN
       jjjjqq stores configuration on an isolated metadata branch (jjjjqq//__//__)
       parented to the repository root.  This branch never appears in normal
       jjjj lloogg output and does not pollute user history.

       Always configure cchheecckk__ccoommmmaanndd before using jjjjqq rruunn.  If cchheecckk__ccoommmmaanndd
       is unset, jjjjqq rruunn will refuse to process items.

LLOOCCKKIINNGG
       jjjjqq uses flock-based file locks in _._j_j_/_j_j_q_-_l_o_c_k_s_/ to coordinate
       concurrent access.  Locks are released automatically by the OS when the
       holding process exits, so stale locks cannot occur.

       iidd     Protects sequence ID allocation (brief, during push).

       ccoonnffiigg Protects configuration reads and writes.

       rruunn    Ensures only one jjjjqq rruunn processes the queue at a time.

DDAATTAA MMOODDEELL
       Queue items are jj bookmarks named jjjjqq//qquueeuuee//_N_N_N_N_N_N where _N_N_N_N_N_N is a
       zero-padded sequence ID.  Failed items use jjjjqq//ffaaiilleedd//_N_N_N_N_N_N..  The
       metadata branch at jjjjqq//__//__ stores the last allocated ID, configuration,
       and an operation log (commit messages include trailers such as sequence
       IDs and workspace paths).

       With the merge strategy, successful merges are ordinary jj commits with
       two parents (trunk and candidate).  With the rebase strategy, the
       candidate is duplicated onto trunk to produce linear history,
       preserving the original change ID.  Failed merges are preserved as
       conflicted commits with descriptions like "Failed: merge N (conflicts)"
       or "Failed: merge N (check)". The workspace path is recorded in
       trailers for later cleanup.

TTYYPPIICCAALL WWOORRKKFFLLOOWW
       Initialize a project:

              jjq init --trunk main --check "make test && make lint"

       Developer queues work:

              jjq push @

       Process the queue:

              jjq run          # one item
              jjq run --all    # drain the queue

       Handle a failure:

              jjq status                    # see what failed
              jj rebase -b <rev> -d main    # rebase onto current trunk
              ... resolve conflicts ...
              jjq push <rev>                # re-queue
              jjq run                       # retry

       Clean up:

              jjq clean

EENNVVIIRROONNMMEENNTT
       jjjjqq must be run from within a jj repository.  It invokes jjjj as a
       subprocess and expects it to be on PPAATTHH.

TTIIPPSS
       jjjjqq iinniitt automatically configures jjjj lloogg to hide jjq metadata
       bookmarks.  For repositories initialized before this feature, run:

              jj config set --repo revsets.log '~ ::jjq/_/_'

       The check command runs in a temporary workspace that has the merged
       state of trunk + candidate.  Any command that works in a normal
       checkout works here.

       Push is cheap.  If you're unsure whether your revision will conflict,
       just push it -- jjjjqq checks for conflicts up front and rejects the push
       immediately.

       For parallel development with multiple agents or developers, use jj
       workspaces.  Each workspace gets its own isolated working copy branched
       from trunk.  Push from each workspace independently and let jjjjqq
       serialize the merges.

SSEEEE AALLSSOO
       jjjj(1)

AAUUTTHHOORRSS
       Paul Smith

jjq                               2026-02-04                            JJQ(1)
